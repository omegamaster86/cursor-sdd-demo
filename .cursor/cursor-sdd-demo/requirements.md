# 要件ドキュメント

## はじめに
本ドキュメントは、在庫管理システム（以下「在庫管理システム」）の **実装方法（HOW）ではなく、満たすべき振る舞い（WHAT）** を定義する。
想定ユーザーは、倉庫担当・店舗担当・管理者・監査/内部統制担当・外部システム連携の利用者とする。

## 要件

### 要件 1: 在庫の参照（一覧・検索・詳細）
**目的:** 倉庫担当として、在庫残を検索して把握したい。それにより欠品や過剰を早期に検知できる。

#### 受け入れ基準
1. When 利用者が在庫一覧を表示, the 在庫管理システム shall SKU・ロケーション単位の在庫残を一覧表示する。
2. When 利用者が検索条件（例：SKU、ロケーション、在庫状態）を指定して検索, the 在庫管理システム shall 条件に一致する在庫のみを表示する。
3. When 利用者が在庫明細を選択, the 在庫管理システム shall 対象在庫の内訳（例：ロット/期限/シリアル等の内訳がある場合）を表示する。
4. If 利用者が存在しない在庫を指定した, the 在庫管理システム shall 「見つからない」ことを示すエラーを返す。
5. The 在庫管理システム shall 在庫の参照結果に在庫の最終更新日時を含める。

### 要件 2: マスタ管理（商品/SKU/ロケーション）
**目的:** 管理者として、在庫の基礎情報を整備したい。それにより在庫データの整合性を保てる。

#### 受け入れ基準
1. When 管理者がSKUを登録, the 在庫管理システム shall 必須項目（例：SKUコード、名称）を検証し登録する。
2. If 同一のSKUコードが既に存在する, the 在庫管理システム shall 重複登録を拒否する。
3. When 管理者がロケーションを登録, the 在庫管理システム shall 必須項目（例：ロケーションコード、名称）を検証し登録する。
4. If 参照または在庫が存在するマスタを削除しようとした, the 在庫管理システム shall 削除を拒否し理由を提示する。
5. The 在庫管理システム shall マスタの変更履歴（作成/更新/削除の事実）を記録する。

### 要件 3: 在庫変動の登録（入庫/出庫/移動/調整）
**目的:** 倉庫担当として、日々の在庫変動を正確に登録したい。それにより在庫残の信頼性を担保できる。

#### 受け入れ基準
1. When 利用者が入庫を登録, the 在庫管理システム shall 対象SKU・数量・ロケーションを記録し在庫残を増加させる。
2. When 利用者が出庫を登録, the 在庫管理システム shall 対象SKU・数量・ロケーションを記録し在庫残を減少させる。
3. When 利用者がロケーション間移動を登録, the 在庫管理システム shall 出庫元を減少させ入庫先を増加させる。
4. When 利用者が調整を登録, the 在庫管理システム shall 調整理由とともに在庫残を増減させる。
5. If 在庫残が不足して出庫/移動が成立しない, the 在庫管理システム shall 登録を拒否し不足を示すエラーを返す。

### 要件 4: 受払履歴（在庫変動履歴）
**目的:** 監査担当として、在庫変動の履歴を追跡したい。それにより不正や誤操作の検知ができる。

#### 受け入れ基準
1. When 利用者が受払履歴を表示, the 在庫管理システム shall 在庫変動（入庫/出庫/移動/調整）の履歴を時系列で表示する。
2. When 利用者が期間・SKU・ロケーション等で履歴検索, the 在庫管理システム shall 条件に一致する履歴のみを返す。
3. The 在庫管理システム shall 各履歴に「誰が」「いつ」「何を（種類）」「どれだけ」「どこで（ロケーション）」を含める。
4. If 権限のない利用者が履歴の閲覧を要求した, the 在庫管理システム shall アクセスを拒否する。
5. The 在庫管理システム shall 履歴を改ざんできない形で保持する（少なくともUI/APIからの編集・削除を許可しない）。

### 要件 5: 棚卸（実在庫との突合・差異処理）
**目的:** 倉庫担当として、棚卸で実在庫とシステム在庫を突合したい。それにより差異を是正できる。

#### 受け入れ基準
1. When 利用者が棚卸を開始, the 在庫管理システム shall 対象範囲（例：ロケーション、SKU、期間）を記録して棚卸セッションを作成する。
2. When 利用者が実棚数量を入力, the 在庫管理システム shall 入力値とシステム在庫を突合し差異を計算する。
3. When 利用者が棚卸差異の確定を実行, the 在庫管理システム shall 差異を調整として記録し在庫残を更新する。
4. If 棚卸が未確定のまま中断された, the 在庫管理システム shall 棚卸セッションを再開できるように保存する。
5. The 在庫管理システム shall 棚卸の確定操作を監査可能な形で記録する。

### 要件 6: ユーザー・権限（アクセス制御）
**目的:** 管理者として、利用者の権限を管理したい。それにより情報漏洩や誤操作を防げる。

#### 受け入れ基準
1. When 利用者がログイン, the 在庫管理システム shall 認証に成功した場合のみ利用を許可する。
2. If 認証に失敗した, the 在庫管理システム shall 失敗として扱い利用を拒否する。
3. While 利用者が未認証, the 在庫管理システム shall 保護された機能（例：在庫閲覧、変動登録、マスタ管理）へのアクセスを拒否する。
4. When 利用者が権限の必要な操作（例：マスタ削除、棚卸確定）を実行, the 在庫管理システム shall 権限に基づいて許可/拒否する。
5. The 在庫管理システム shall 権限に関する変更（付与/剥奪）を履歴として記録する。

### 要件 7: エクスポート/インポート（データ入出力）
**目的:** 管理者として、在庫や履歴データを外部で利用できる形で出力したい。それにより分析や連携ができる。

#### 受け入れ基準
1. When 利用者が在庫一覧のエクスポートを要求, the 在庫管理システム shall 表示中の検索条件に一致するデータを出力する。
2. When 利用者が受払履歴のエクスポートを要求, the 在庫管理システム shall 指定条件に一致する履歴を出力する。
3. If 出力対象が0件である, the 在庫管理システム shall 0件であることを明示して出力する。
4. When 管理者がマスタのインポートを実行, the 在庫管理システム shall 入力データの検証結果（成功/失敗と理由）を返す。
5. The 在庫管理システム shall エクスポート/インポート操作の実行者と実行日時を記録する。

### 要件 8: アラート（閾値・異常検知）
**目的:** 倉庫担当として、欠品や期限切れの兆候を事前に知りたい。それにより販売機会損失や廃棄を減らせる。

#### 受け入れ基準
1. Where 欠品閾値が設定されている, the 在庫管理システム shall 在庫残が閾値未満になったことを検知できる。
2. Where 期限管理が有効である, the 在庫管理システム shall 期限切れまたは期限間近の在庫を検知できる。
3. When 検知条件に該当, the 在庫管理システム shall アラートとして一覧化できる。
4. If 同一条件のアラートが継続している, the 在庫管理システム shall 重複を適切に扱える（例：同一アラートの集約）。
5. The 在庫管理システム shall アラートの発生・解消の履歴を記録する。

### 要件 9: 非機能（性能・可用性・整合性・監査）
**目的:** 運用担当として、業務で安定して使える水準を担保したい。それにより運用負荷を下げられる。

#### 受け入れ基準
1. The 在庫管理システム shall 同一の在庫に対する並行した更新があっても整合性が破綻しない。
2. While サービス提供中, the 在庫管理システム shall 重大障害時に原因調査可能なログを保持する。
3. If 想定外エラーが発生した, the 在庫管理システム shall 利用者に再試行可能な形でエラーを提示し、エラー事象を記録する。
4. The 在庫管理システム shall 重要操作（例：在庫変動登録、マスタ更新、棚卸確定）の監査証跡を保持する。
5. The 在庫管理システム shall 個人情報または機密情報に該当するデータがある場合、アクセス制御により閲覧を制限する。

## 成果物（推奨）
このフェーズの出力を **設計の一次ソース** に落とし込むため、要件ドラフトが出た時点で以下を作成/更新する。

※ 自動初期作成（上書き禁止）のルールは `.cursor/rules/artifacts-generation.md` を参照。

- `.cursor/cursor-sdd-demo/artifacts/feature-list.md`（MVP/Phase と UI/API/Batch の一覧）

テンプレート:
- `.cursor/templates/artifacts/create-feature-list.md`

---

## 変更履歴

| 日付 | バージョン | 変更者 | 変更内容 |
| ---- | ---------- | ------ | -------- |
| 2025-12-14 | v1.0 | kanbaramasatoshi | 初版作成 |
| 2025-12-14 | v1.1 | kanbaramasatoshi | 要件ドラフト生成 |
